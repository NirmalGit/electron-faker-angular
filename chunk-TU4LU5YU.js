import{D as n,G as u,Q as g,a as l,b as m,c as p,gb as s,mb as h}from"./chunk-A7ZUIS7E.js";var c=class o{isDevelopment;constructor(){this.isDevelopment=h(),this.isDevelopment&&console.log("\u{1F527} [LOGGER] Development mode - Logging enabled")}log(t,e,...r){this.isDevelopment&&console.log(`${t} ${e}`,...r)}info(t,e,...r){this.isDevelopment&&console.info(`${t} ${e}`,...r)}warn(t,e,...r){this.isDevelopment&&console.warn(`${t} ${e}`,...r)}error(t,e,...r){console.error(`${t} ${e}`,...r)}debug(t,e,...r){this.isDevelopment&&console.debug(`${t} ${e}`,...r)}isDev(){return this.isDevelopment}group(t,e){this.isDevelopment&&(console.group(t),e(),console.groupEnd())}groupCollapsed(t,e){this.isDevelopment&&(console.groupCollapsed(t),e(),console.groupEnd())}table(t,e){this.isDevelopment&&(e?console.table(t,e):console.table(t))}time(t){this.isDevelopment&&console.time(t)}timeEnd(t){this.isDevelopment&&console.timeEnd(t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var v=class o{constructor(t){this.logger=t;this.logger.info("\u{1F6D2} [CART SERVICE]","Service initialized"),this.loadCartFromStorage()}_cart=g({items:[],totalItems:0,totalAmount:0,createdAt:new Date,updatedAt:new Date});_orders=g([]);cart=this._cart.asReadonly();orders=this._orders.asReadonly();isEmpty=s(()=>this._cart().items.length===0);itemCount=s(()=>this._cart().items.reduce((t,e)=>t+e.quantity,0));cartSummary=s(()=>{let t=this._cart(),e=t.totalAmount,r=this.calculateShipping(e),a=this.calculateTax(e);return{itemCount:t.totalItems,subtotal:e,shipping:r,tax:a,total:e+r+a}});addToCart(t,e=1){this.logger.info("\u{1F6D2} [CART SERVICE]","Adding to cart:",{productId:t.id,title:t.title,quantity:e});let r=this._cart(),a=r.items.findIndex(d=>d.product.id===t.id),i;if(a>=0)i=[...r.items],i[a]=m(l({},i[a]),{quantity:i[a].quantity+e,subtotal:(i[a].quantity+e)*t.price}),this.logger.info("\u{1F6D2} [CART SERVICE]","Updated existing item quantity");else{let d={product:t,quantity:e,subtotal:t.price*e};i=[...r.items,d],this.logger.info("\u{1F6D2} [CART SERVICE]","Added new item to cart")}this.updateCart(i)}removeFromCart(t){this.logger.info("\u{1F6D2} [CART SERVICE]","Removing from cart:",{productId:t});let r=this._cart().items.filter(a=>a.product.id!==t);this.updateCart(r)}updateQuantity(t,e){if(this.logger.info("\u{1F6D2} [CART SERVICE]","Updating quantity:",{productId:t,quantity:e}),e<=0){this.removeFromCart(t);return}let a=this._cart().items.map(i=>i.product.id===t?m(l({},i),{quantity:e,subtotal:i.product.price*e}):i);this.updateCart(a)}getItemQuantity(t){let e=this._cart().items.find(r=>r.product.id===t);return e?e.quantity:0}isInCart(t){return this._cart().items.some(e=>e.product.id===t)}clearCart(){this.logger.info("\u{1F6D2} [CART SERVICE]","Clearing cart"),this._cart.set({items:[],totalItems:0,totalAmount:0,createdAt:new Date,updatedAt:new Date}),this.saveCartToStorage()}createOrder(t){return p(this,null,function*(){this.logger.info("\u{1F6D2} [CART SERVICE]","Creating order");let e=this.cartSummary(),r=this.generateOrderId(),a={id:r,cart:t.cart,billing:t.billing,shipping:t.shipping,payment:{method:t.payment.method,cardholderName:t.payment.cardholderName,paypalEmail:t.payment.paypalEmail,cryptoWallet:t.payment.cryptoWallet},subtotal:e.subtotal,shipping_cost:e.shipping,tax:e.tax,total:e.total,status:"pending",createdAt:new Date,estimatedDelivery:this.calculateEstimatedDelivery(t.shipping.shippingMethod)},i=this._orders();return this._orders.set([...i,a]),this.clearCart(),this.logger.info("\u{1F6D2} [CART SERVICE]","Order created successfully:",{orderId:r}),a})}getOrder(t){return this._orders().find(e=>e.id===t)}updateCart(t){let e=t.reduce((a,i)=>a+i.quantity,0),r=t.reduce((a,i)=>a+i.subtotal,0);this._cart.set({items:t,totalItems:e,totalAmount:r,createdAt:this._cart().createdAt,updatedAt:new Date}),this.saveCartToStorage()}calculateShipping(t){return t>=50?0:9.99}calculateTax(t){return t*.085}generateOrderId(){let t=Date.now(),e=Math.random().toString(36).substring(2,8);return`ORD-${t}-${e}`.toUpperCase()}calculateEstimatedDelivery(t){let e=new Date,r=new Date(e);switch(t){case"overnight":r.setDate(e.getDate()+1);break;case"express":r.setDate(e.getDate()+3);break;case"standard":default:r.setDate(e.getDate()+7);break}return r}saveCartToStorage(){try{let t=JSON.stringify(this._cart());localStorage.setItem("cart",t),this.logger.debug("\u{1F6D2} [CART SERVICE]","Cart saved to localStorage")}catch(t){this.logger.error("\u{1F6D2} [CART SERVICE]","Failed to save cart to localStorage:",String(t))}}loadCartFromStorage(){try{let t=localStorage.getItem("cart");if(t){let e=JSON.parse(t);e.createdAt=new Date(e.createdAt),e.updatedAt=new Date(e.updatedAt),this._cart.set(e),this.logger.info("\u{1F6D2} [CART SERVICE]","Cart loaded from localStorage")}}catch(t){this.logger.error("\u{1F6D2} [CART SERVICE]","Failed to load cart from localStorage:",String(t)),this._cart.set({items:[],totalItems:0,totalAmount:0,createdAt:new Date,updatedAt:new Date})}}static \u0275fac=function(e){return new(e||o)(u(c))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{c as a,v as b};
